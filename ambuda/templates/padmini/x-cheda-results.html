{% set space = "&nbsp;"|safe %}
{% set base_classes = "inline-block px-2 py-1 mb-4 rounded a-hover-underline mr-1" %}


{% macro inline_view(token_spans) %}
{% for span in token_spans -%}
  <div class="{{ base_classes }} {{ span.last.classes }}">
    <div class="text-2xl">
      {%- for t in span.tokens if t.text -%}
        {%- set display_text = t.text|slp2dev -%}
        {%- set pada_url = url_for('padmini.search', query=display_text) -%}
        <a href="{{ pada_url }}" data-text="{{ display_text }}">{{- display_text or space -}}
        </a><span class="opacity-30">{{- t.separator -}}</span>
      {%- endfor -%}
    </div>

    <div class="text-sm">
      {%- for t in span.tokens if t.text -%}
        {%- set display_lemma = t.lemma|slp2dev -%}
        {%- set pada_url = url_for('padmini.search', query=display_lemma) -%}
        <a href="{{ pada_url }}" data-text="{{ display_lemma }}">{{ display_lemma or space }}</a>{{- t.separator -}}
      {%- endfor -%}
    </div>

    <div class="text-xs">{{ span.last.short_gloss or space }}</div>
  </div>
{%- endfor %}
{% endmacro %}


{% macro table_view(token_spans) %}
<table class="w-full border border-slate-200">
  <tr class="text-left bg-slate-100 text-slate-500 uppercase text-xs border-b-2 border-slate-200">
    <th class="p-1 py-3">Text</th>
    <th class="p-1 py-3">Base</th>
    <th class="p-1 py-3">Analysis</th>
  </tr>
  {% for span in token_spans %}
    {% for token in span.tokens if token.is_sanskrit %}
      {% set display_text = token.text|slp2dev %}
      {% set display_lemma = token.lemma|slp2dev %}
      <tr class="odd:bg-slate-50">
          <td class="p-1 text-xl">{{ display_text or space }}{{ token.separator }}</td>
          <td class="p-1">{{ display_lemma }}</td>
          <td class="text-sm">{{ token.long_gloss }}</td>
      </tr>
    {% endfor %}
  {% endfor %}
</table>
{% endmacro %}


{% macro cheda_card(token_spans) %}
<div x-data="{tab: 'inline'}">
  <div class="text-sm">
    <span>View as:</span>
    <span class="text-slate-600">
      <button class="hover:underline py-2" @click.prevent="tab = 'inline'">Inline</button> |
      <button class="hover:underline py-2" @click.prevent="tab = 'table'">Table</button>
    </span>
  </div>
  <div x-show="tab === 'inline'">
    {{ inline_view(token_spans) }}
  </div>
  <div x-show="tab === 'table'">
    {{ table_view(token_spans) }}
  </div>
</div>
{% endmacro %}
